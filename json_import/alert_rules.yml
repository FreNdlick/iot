groups:
  - name: sensor_alerts
    rules:
      # –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –¥–∞—Ç—á–∏–∫–∞ 000DE0163B57
      - alert: HighPM25_000DE0163B57
        expr: mqtt_000DE0163B57_pm25 < 0 or mqtt_000DE0163B57_pm25 > 400
        for: 5m
        labels:
          severity: critical
          sensor_id: 000DE0163B57
        annotations:
          summary: "üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ PM2.5: {{ $value }} ¬µg/m¬≥"
          description: |
            **–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** {{ $value | printf "%.1f" }} ¬µg/m¬≥
            **–î–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω:** 0 - 400 ¬µg/m¬≥
            **–î–∞—Ç—á–∏–∫:** 000DE0163B57

      - alert: LowHumidity_000DE0163B57
        expr: mqtt_000DE0163B57_humidity < 10 or mqtt_000DE0163B57_humidity > 95
        for: 5m
        labels:
          severity: warning
          sensor_id: 000DE0163B57
        annotations:
          summary: "‚ö†Ô∏è –í–ª–∞–∂–Ω–æ—Å—Ç—å –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞: {{ $value }}%"
          description: |
            **–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** {{ $value | printf "%.1f" }}%
            **–î–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω:** 10% - 95%
            **–î–∞—Ç—á–∏–∫:** 000DE0163B57

      - alert: HighTemperature_000DE0163B57
        expr: mqtt_000DE0163B57_temperature_c < -10 or mqtt_000DE0163B57_temperature_c > 50
        for: 5m
        labels:
          severity: critical
          sensor_id: 000DE0163B57
        annotations:
          summary: "üö® –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞: {{ $value }}¬∞C"
          description: |
            **–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** {{ $value | printf "%.1f" }}¬∞C
            **–î–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω:** -10¬∞C - 50¬∞C
            **–î–∞—Ç—á–∏–∫:** 000DE0163B57

      - alert: DynamicHighTemperature_000DE0163B57
        expr: mqtt_000DE0163B57_temperature_c > avg_over_time(mqtt_000DE0163B57_temperature_c[1h]) + (2 * stddev_over_time(mqtt_000DE0163B57_temperature_c[1h]))
        for: 5m
        labels:
          severity: critical
          sensor_id: 000DE0163B57
        annotations:
          summary: "üö® –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø—Ä–µ–≤—ã—Å–∏–ª–∞ Œº+2œÉ: {{ $value }}¬∞C"
          description: |
            **–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** {{ $value | printf "%.1f" }}¬∞C
            **–°—Ä–µ–¥–Ω–µ–µ –∑–∞ —á–∞—Å:** {{ with query "avg_over_time(mqtt_000DE0163B57_temperature_c[1h])" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}¬∞C
            **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ:** {{ with query "stddev_over_time(mqtt_000DE0163B57_temperature_c[1h])" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}¬∞C
            **–î–∞—Ç—á–∏–∫:** {{ $labels.sensor_id }}

      - alert: DynamicLowTemperature_000DE0163B57
        expr: mqtt_000DE0163B57_temperature_c < avg_over_time(mqtt_000DE0163B57_temperature_c[1h]) - (2 * stddev_over_time(mqtt_000DE0163B57_temperature_c[1h]))
        for: 5m
        labels:
          severity: critical
          sensor_id: 000DE0163B57
        annotations:
          summary: "üö® –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∏–∂–µ Œº-2œÉ: {{ $value }}¬∞C"
          description: |
            **–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** {{ $value | printf "%.1f" }}¬∞C
            **–°—Ä–µ–¥–Ω–µ–µ –∑–∞ —á–∞—Å:** {{ with query "avg_over_time(mqtt_000DE0163B57_temperature_c[1h])" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}¬∞C
            **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ:** {{ with query "stddev_over_time(mqtt_000DE0163B57_temperature_c[1h])" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}¬∞C
            **–î–∞—Ç—á–∏–∫:** {{ $labels.sensor_id }}

      - alert: HighHumidityQuantile_000DE0163B57
        expr: mqtt_000DE0163B57_humidity > quantile_over_time(0.95, mqtt_000DE0163B57_humidity[1h])
        for: 5m
        labels:
          severity: high
          sensor_id: 000DE0163B57
        annotations:
          summary: "‚ö†Ô∏è‚ö° –í–ª–∞–∂–Ω–æ—Å—Ç—å –≤—ã—à–µ 95% –∫–≤–∞–Ω—Ç–∏–ª—è: {{ $value }}%"
          description: |
            **–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** {{ $value | printf "%.1f" }}%
            **95% –∫–≤–∞–Ω—Ç–∏–ª—å:** {{ with query "quantile_over_time(0.95, mqtt_000DE0163B57_humidity[1h])" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}%
            **–î–∞—Ç—á–∏–∫:** {{ $labels.sensor_id }}

      - alert: LowHumidityQuantile_000DE0163B57
        expr: mqtt_000DE0163B57_humidity < quantile_over_time(0.05, mqtt_000DE0163B57_humidity[1h])
        for: 5m
        labels:
          severity: high
          sensor_id: 000DE0163B57
        annotations:
          summary: "‚ö†Ô∏è‚ö° –í–ª–∞–∂–Ω–æ—Å—Ç—å –Ω–∏–∂–µ 5% –∫–≤–∞–Ω—Ç–∏–ª—è: {{ $value }}%"
          description: |
            **–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** {{ $value | printf "%.1f" }}%
            **5% –∫–≤–∞–Ω—Ç–∏–ª—å:** {{ with query "quantile_over_time(0.05, mqtt_000DE0163B57_humidity[1h])" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}%
            **–î–∞—Ç—á–∏–∫:** {{ $labels.sensor_id }}

      - alert: ErrorInSensor_000DE0163B57
        expr: mqtt_000DE0163B57_alarm_status == 1
        for: 2m
        labels:
          severity: critical
          sensor_id: 000DE0163B57
        annotations:
          summary: "üö® –û—à–∏–±–∫–∞ –¥–∞—Ç—á–∏–∫–∞ 000DE0163B57"
          description: |
            **–°—Ç–∞—Ç—É—Å —Ç—Ä–µ–≤–æ–≥–∏:** –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
            **–î–∞—Ç—á–∏–∫:** 000DE0163B57

      - alert: Heartbeat_000DE0163B57
        expr: >
          absent_over_time(mqtt_000DE0163B57_temperature_c[5m])
          and
          (time() - process_start_time_seconds{job="prometheus"} > 600)
        for: 2m
        labels:
          severity: critical
          sensor_id: 000DE0163B57
        annotations:
          summary: "üö® –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç –¥–∞—Ç—á–∏–∫–∞ 000DE0163B57"
          description: |
            **–°—Ç–∞—Ç—É—Å:** –ù–µ –æ—Ç–≤–µ—á–∞–µ—Ç –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç
            **–î–∞—Ç—á–∏–∫:** 000DE0163B57

      - alert: Temperature_Upper_Quantile_Breach
        expr: |
          mqtt_000DE0163B57_temperature_c > mqtt_000DE0163B57_temp_upper_q
          or
          mqtt_000DE0163B57_temperature_c < mqtt_000DE0163B57_temp_lower_q
        for: 10m
        labels:
          severity: warning
          metric_type: temperature
          sensor_id: 000DE0163B57
        annotations:
          summary: "‚ö†Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤–Ω–µ –∫–≤–∞–Ω—Ç–∏–ª—å–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü: {{ $value }}¬∞C"
          description: |
            **–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** {{ $value | printf "%.1f" }}¬∞C
            **–î–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω:** {{ with query "mqtt_000DE0163B57_temp_lower_q" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}¬∞C - {{ with query "mqtt_000DE0163B57_temp_upper_q" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}¬∞C
            **–î–∞—Ç—á–∏–∫:** {{ $labels.sensor_id }}

      - alert: Temperature_Stddev_Breach
        expr: |
          mqtt_000DE0163B57_temperature_c > mqtt_000DE0163B57_temp_upper_std
          or
          mqtt_000DE0163B57_temperature_c < mqtt_000DE0163B57_temp_lower_std
        for: 15m
        labels:
          severity: critical
          metric_type: temperature
          sensor_id: 000DE0163B57
        annotations:
          summary: "üö® –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ Œº¬±2œÉ: {{ $value }}¬∞C"
          description: |
            **–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** {{ $value | printf "%.1f" }}¬∞C
            **–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã:**
            - –í–µ—Ä—Ö–Ω—è—è (Œº+2œÉ): {{ with query "mqtt_000DE0163B57_temp_upper_std" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}¬∞C
            - –ù–∏–∂–Ω—è—è (Œº-2œÉ): {{ with query "mqtt_000DE0163B57_temp_lower_std" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}¬∞C
            **–î–∞—Ç—á–∏–∫:** {{ $labels.sensor_id }}

      - alert: Humidity_Quantile_Breach
        expr: mqtt_000DE0163B57_humidity >10
        for: 3m
        labels:
          severity: warning
          metric_type: humidity
          sensor_id: 000DE0163B57
        annotations:
          summary: "‚ö†Ô∏è –í–ª–∞–∂–Ω–æ—Å—Ç—å –≤–Ω–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞: {{ $value }}%"
          description: |
            **–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** {{ $value | printf "%.1f" }}%
            **–î–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω:** {{ with query "mqtt_000DE0163B57_humidity_lower_q" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}% - {{ with query "mqtt_000DE0163B57_humidity_upper_q" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}%
            **–î–∞—Ç—á–∏–∫:** {{ $labels.sensor_id }}

      - alert: DewPoint_Rapid_Change
        expr: abs(mqtt_000DE0163B57_dew_point_rate) > 0.3
        for: 5m
        labels:
          severity: warning
          metric_type: dew_point
          sensor_id: 000DE0163B57
        annotations:
          summary: "‚ö†Ô∏è –†–µ–∑–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–æ—á–∫–∏ —Ä–æ—Å—ã: {{ $value }}¬∞C/–º–∏–Ω"
          description: |
            **–°–∫–æ—Ä–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:** {{ $value | printf "%.2f" }}¬∞C/–º–∏–Ω
            **–ü–æ—Ä–æ–≥–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** 0.3¬∞C/–º–∏–Ω
            **–î–∞—Ç—á–∏–∫:** {{ $labels.sensor_id }}

      - alert: DewPoint_Quantile_Anomaly2
        expr: |
          (mqtt_000DE0163B57_dew_point_c > mqtt_000DE0163B57_dew_point_upper_q)
          or
          (mqtt_000DE0163B57_dew_point_c < mqtt_000DE0163B57_dew_point_lower_q)
        for: 2m
        labels:
          severity: info
          metric_type: dew_point
          sensor_id: 000DE0163B57
        annotations:
          summary: "‚ÑπÔ∏è –¢–æ—á–∫–∞ —Ä–æ—Å—ã –≤ –∞–Ω–æ–º–∞–ª—å–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ: {{ $value }}¬∞C"
          description: |
            **–û–ø–æ–≤–µ—â–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞:** info
            **–ü–æ—è—Å–Ω–µ–Ω–∏–µ:** –¢–æ—á–∫–∞ —Ä–æ—Å—ã –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
            **–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** {{ $value | printf "%.1f" }}¬∞C
            **–î–æ–ø—É—Å—Ç–∏–º—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω:** {{ with query "mqtt_000DE0163B57_dew_point_lower_q" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}¬∞C - {{ with query "mqtt_000DE0163B57_dew_point_upper_q" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}¬∞C
            **–î–∞—Ç—á–∏–∫:** {{ $labels.sensor_id }}

      - alert: DewPoint_Quantile_Proximity
        expr: |
          (mqtt_000DE0163B57_dew_point_c >= mqtt_000DE0163B57_dew_point_max_5m)
          or
          (mqtt_000DE0163B57_dew_point_c <= mqtt_000DE0163B57_dew_point_min_5m)
        for: 5m
        labels:
          severity: warning
          metric_type: dew_point
          sensor_id: 000DE0163B57
        annotations:
          summary: "‚ö†Ô∏è –ö–≤–∞–Ω—Ç–∏–ª—å —Ç–æ—á–∫–∏ —Ä–æ—Å—ã –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –∫ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é"
          description: |
            **–û–ø–æ–≤–µ—â–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞:** warning
            **–ü–æ—è—Å–Ω–µ–Ω–∏–µ:** –¢–æ—á–∫–∞ —Ä–æ—Å—ã –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç—Å—è –∫ –º–∞–∫—Å–∏–º—É–º—É –∏–ª–∏ –º–∏–Ω–∏–º—É–º—É –∑–∞ 5 –º–µ—Å—è—Ü–µ–≤
            **–¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:** {{ $value | printf "%.1f" }}¬∞C
            **–ú–∞–∫—Å–∏–º—É–º –∑–∞ 5 –º–µ—Å—è—Ü–µ–≤:** {{ with query "mqtt_000DE0163B57_dew_point_max_5m" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}¬∞C
            **–ú–∏–Ω–∏–º—É–º –∑–∞ 5 –º–µ—Å—è—Ü–µ–≤:** {{ with query "mqtt_000DE0163B57_dew_point_min_5m" }}{{ . | first | value | printf "%.1f" }}{{ else }}N/A{{ end }}¬∞C
            **–î–∞—Ç—á–∏–∫:** {{ $labels.sensor_id }}

  - name: test_alerts
    rules:
      - alert: TestAlert
        expr: anomaly_test == 1.0
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "–¢–µ—Å—Ç–æ–≤—ã–π –∞–ª–µ—Ä—Ç —Å—Ä–∞–±–æ—Ç–∞–ª"
          description: "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π –∞–ª–µ—Ä—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π. –ó–Ω–∞—á–µ–Ω–∏–µ anomaly_test: {{ $value }}."

  - name: example
    rules:
      - alert: InstanceDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Instance {{ $labels.instance }} down"
          description: "{{ $labels.instance }} of job {{ $labels.job }} has been down for more than a minute."

      - alert: TestAlert
        expr: vector(1)
        for: 1m
        labels:
          severity: info
        annotations:
          summary: "Test alert triggered!"
